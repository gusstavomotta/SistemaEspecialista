{% extends 'EscalaPoms/base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/perfil.css' %}">
{% endblock %}

{% block title %}Meu Perfil{% endblock %}

{% block content %}
  <section class="perfil">
    <header class="header">
      <h1>Meu Perfil</h1>
    </header>

    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert {{ message.tags }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- Foto de perfil -->
      <div class="photo-field">
        {% if usuario.foto %}
          <img src="{{ usuario.foto.url }}" alt="Foto de {{ usuario.nome }}" class="photo-preview">
          <button type="submit" name="remove_foto" value="1" class="btn btn-secondary">Remover Foto</button>
        {% else %}
          <div class="photo-preview empty"></div>
          <input type="file" name="foto" accept="image/*">
        {% endif %}
      </div>

      <!-- Campos básicos -->
      <div class="profile-field">
        <span class="label">CPF:</span>
        <span class="value">{{ usuario.cpf }}</span>
      </div>
      <div class="profile-field">
        <span class="label">Nome:</span>
        <span class="value">{{ usuario.nome }}</span>
      </div>
      <div class="profile-field">
        <span class="label">Email:</span>
        <input type="email" name="email" value="{{ usuario.email }}" required>
      </div>
      <div class="profile-field">
        <span class="label">Telefone:</span>
        <input type="text" name="telefone" value="{{ usuario.num_telefone }}" required>
      </div>
      <div class="profile-field">
        <span class="label">Gênero:</span>
        <span class="value">{{ usuario.genero }}</span>
      </div>

      <!-- Treinador atual -->
      {% if usuario.treinador %}
        <div class="profile-field">
          <span class="label">Treinador Atual:</span>
          <span class="value">{{ usuario.treinador.nome }}</span>
        </div>
      {% endif %}

      <!-- Dropdown de troca, se aplicável -->
      {% if form_troca %}
        <div class="alert alert-warning">
          Seu treinador atual está desativado. Selecione um novo treinador ativo:
        </div>
        <div class="profile-field">
          <select name="treinador" class="form-control" required>
            <option value="" disabled selected>Selecione um treinador</option>
            {% for t in form_troca.fields.treinador.queryset %}
              <option value="{{ t.cpf }}" {% if form_troca.initial.treinador == t or form_troca.data.treinador == t.cpf %}selected{% endif %}>
                {{ t.nome }}
              </option>
            {% endfor %}
          </select>
          {% if form_troca.errors.treinador %}
            <div class="invalid-feedback d-block">{{ form_troca.errors.treinador|first }}</div>
          {% endif %}
        </div>
        <div class="profile-actions">
          <button type="submit" name="trocar_treinador" class="btn btn-primary">Trocar Treinador</button>
        </div>
      {% endif %}

      <!-- Botão salvar perfil padrão -->
      <div class="profile-actions">
        <button type="submit" class="btn btn-success">Salvar Perfil</button>
      </div>

      <!-- Excluir conta -->
      <div class="delete-account">
        <a href="{% url 'solicitar_exclusao' %}" class="btn btn-danger">Excluir Conta</a>
      </div>
    </form>
  </section>
{% endblock %}
