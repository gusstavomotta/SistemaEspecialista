{% extends 'EscalaPoms/base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/perfil.css' %}">
{% endblock %}

{% block title %}Meu Perfil{% endblock %}

{% block content %}

  <section class="perfil">
    <header class="header">
      <h1>Meu Perfil</h1>
    </header>

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- Foto de perfil -->
      <div class="photo-field">
        {% if usuario.foto %}
          <img src="{{ usuario.foto.url }}" alt="Foto de {{ usuario.nome }}" class="photo-preview">
          <button type="submit" name="remove_foto" value="1" class="remove-photo-btn">Remover Foto</button>
        {% else %}
          <div class="photo-preview empty"></div>
          <input type="file" name="foto" accept="image/*">
        {% endif %}
      </div>

      <!-- Campos básicos -->
      <div class="profile-field">
        <span class="label">CPF:</span>
        <span class="value">{{ usuario.cpf }}</span>
      </div>
      <div class="profile-field">
        <span class="label">Nome:</span>
        <span class="value">{{ usuario.nome }}</span>
      </div>
      <div class="profile-field">
        <span class="label">Email:</span>
        <input type="email" name="email" value="{{ usuario.email }}" required>
      </div>
      <div class="profile-field">
        <span class="label">Telefone:</span>
        <input type="text" name="telefone" value="{{ usuario.num_telefone }}" required>
      </div>
      <div class="profile-field">
        <span class="label">Gênero:</span>
        <span class="value">{{ usuario.genero }}</span>
      </div>

      <!-- Troca de treinador -->
      {% if form_troca %}
        <div class="alert alert-warning">
          Seu treinador atual está desativado. Selecione um novo treinador:
        </div>
        <div class="profile-field">
          <span class="label">Novo Treinador:</span>
          <select name="treinador" required>
            <option value="" disabled selected>Selecione…</option>
            {% for t in form_troca.fields.treinador.queryset %}
              <option value="{{ t.cpf }}" {% if form_troca.initial.treinador == t or form_troca.data.treinador == t.cpf %}selected{% endif %}>
                {{ t.nome }}
              </option>
            {% endfor %}
          </select>
        </div>
      {% endif %}

      <!-- Ações -->
      <div class="profile-actions">
        {% if form_troca %}
          <button type="submit" name="trocar_treinador" class="btn-primary">Trocar</button>
        {% endif %}
        <a href="{% url 'solicitar_exclusao' %}" class="btn-danger">Excluir</a>
        <button type="submit" class="btn-success">Salvar</button>
      </div>
    </form>
  </section>
{% endblock %}

{% block extra_scripts %}
{% endblock %}